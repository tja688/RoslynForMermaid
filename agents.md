# agents.md — ArchRadar Workbench UX/Interaction Fix Plan

## 背景
当前 ArchRadar 前端工作台的核心痛点集中在“导航缺失 + 画布不可操作 + 交互反馈弱 + 布局与样式不成体系 + 配置表单混乱”。
前端主逻辑集中于 `frontend-ui/src/app/App.tsx`（useState/useEffect 管状态，无全局状态库），Mermaid 预览在 `frontend-ui/src/components/MermaidPreview/MermaidPreview.tsx`（mermaid.render + 点击识别）。后端/API 当前主要提供数据与扫描编排，不是本轮 UX 的主要瓶颈。

> 目标：在不大改核心扫描/数据结构的前提下，把工作台从“能跑的 MVP”提升到“可用的工具”。

---

## 总目标（Definition of Done）
- 用户能够在 L0/L1/L2/节点下钻之间自由前进与回退：支持 Back / Up / Home(L0)。
- Mermaid 画布支持：缩放、拖拽、重置视图、Fit-to-screen、选中节点居中（至少前四项）。
- 点击/悬停具备明确反馈：可点击性可感知，选中态在画布与 Inspector 一致。
- 页面改为工具型三栏布局：画布占主要空间；侧栏可折叠、可滚动；页面不再“无限长表单”。
- 文本溢出与按钮无样式问题消失：长路径/namespace 不破版；按钮/输入风格统一。
- 配置面板“所见即所得”：可编辑字段明确、只读字段不可交互；保存/校验/错误信息清楚。

---

## 非目标（Non-goals）
- 不要求重写后端/扫描逻辑。
- 不在本轮实现复杂功能：右键菜单、lint overlay、snapshot diff 等（可留 TODO）。
- 不要求引入重型 UI 框架；但允许引入轻量状态/布局工具（仅在必要时）。

---

## 痛点拆解与任务

### P0 — 导航系统（致命可用性）
**问题描述**
- 目前“只有下没有上，一去不返”：缺少返回/回上级/回 L0；缺少 breadcrumb；缺少历史栈。
- 导致用户无法探索图谱，工具等于不可用。

**任务**
1. 建立“导航状态模型”
   - 定义清晰的导航层级：Project -> Snapshot -> Layer(L0/L1/L2) -> Node/Edge Selection -> Drilldown Target
   - 维护可回溯的 history stack（前进/后退/回上级/回L0）
2. 在 UI 顶部或画布区提供导航控件
   - Back / Up / Home(L0) / Breadcrumb
3. 导航一致性
   - 任何下钻/切层都必须可回退
   - 切换 Snapshot/Project 时重置或迁移状态有明确规则

**验收标准**
- 任意一次下钻后：Back 必定可回到上一个视图；Up 必定回到上层；Home 必定回 L0。
- 切换 Layer/Snapshot/Project 不会出现“卡死在不可回退状态”。

---

### P0：启动即扫描导致“打不开”的逻辑耦合（必须彻底改）
问题描述（专业表述）

当前系统在使用 MsBuildSolution 配置启动（后端 + 前端）时，由于 配置与扫描触发逻辑被默认放在启动链路中/由前端默认持久化配置驱动，导致应用在启动阶段就进入扫描流程。一旦扫描失败（MsBuildLocator / restore / 环境不满足），会造成：

UI 首屏依赖扫描产物或阻塞在扫描流程上，页面无法正常打开/进入工作台；

上一次保存的前端配置会“污染”本次启动，使得“打开项目”不再是默认可用工作流；

前端配置持久化与服务生命周期绑定，造成“配置影响所有前后端服务”的耦合问题。

目标（必须达成）

打开不扫描：启动服务后，工作台必须可打开并可交互；扫描只能由前端显式请求触发（如点击 Scan）。

前端配置/历史不影响服务可用性：任何持久化配置都不应导致服务启动失败或 UI 无法进入。

默认工作流稳定：每次“打开项目”都进入一套稳定默认流程（可用的初始视图 + 可选扫描），与上次的配置/操作历史解耦。

职责分离：

后端负责：健康检查、项目/快照/扫描编排、workspace 存取；

前端负责：交互态（选中、视口、历史、过滤）、配置编辑 UI；

---

### P0 — Mermaid 画布视口能力（缩放/拖动/重置）
**问题描述**
- 画布无法缩放/拖动/重置视图，大图不可读。

**任务**
1. 加入 viewport 交互能力：Pan / Zoom / Reset / Fit
2. 基本快捷操作
   - 鼠标滚轮缩放、按住拖动平移、双击/按钮重置（具体交互可自行定，但要一致）
3. 与选中态联动
   - 点击节点后可选：高亮 +（可选）自动居中/放大到节点范围

**验收标准**
- 大图可通过拖拽与缩放顺畅浏览；一键 reset/fit 能回到可读状态。
- 交互不影响节点点击识别（不会“拖拽时误触点击”或相反）。

---

### P1 — 可点击性与选中反馈（交互闭环）
**问题描述**
- 点击反馈弱：不知道能不能点、点没点上、现在选中了谁。
- Inspector 与画布选中态可能不同步。

**任务**
1. Hover 提示（cursor/outline/tooltip）
2. Selected 高亮（节点/边视觉区分）
3. Click 命中反馈（例如轻量动画/状态栏提示/Inspector 标题同步更新）
4. 空白处点击清空选中态，并有明确反馈

**验收标准**
- 用户无需猜测即可知道哪些可点；点中后 200ms 内能感知“已选中”。
- 画布高亮与 Inspector 内容始终一致。

---

### P1 — 布局与信息密度重构（三栏工具布局）
**问题描述**
- 页面很长、配置面板把画布挤没，空间利用率低；布局僵硬难看。

**任务**
1. 设计标准三栏：
   - 左栏：Data Source / Project / Snapshot / Layer
   - 中栏：Mermaid 画布（主区域）
   - 右栏：Inspector / Status
2. 侧栏交互：
   - 可折叠（Collapse）、可滚动（独立滚动容器）、可调宽度（可选）
3. 状态栏收敛：
   - 把“状态/错误/health”集中到不占高度的位置（例如底部 toast 或右下角面板）

**验收标准**
- 1080p 屏幕下：画布区域始终占主要空间（视觉上 > 60% 宽度）。
- 配置再多也不会把页面拉到“无限长”，只在侧栏滚动。

---

### P1 — 视觉与样式系统（修复溢出与无样式控件）
**问题描述**
- 文字溢出、按钮无样式、控件风格不统一，严重影响可信度。

**任务**
1. 统一组件风格：Button/Input/Select/Card/Section Header
2. 长文本策略：ellipsis + hover tooltip + copy-to-clipboard（至少前两项）
3. 关键按钮与危险操作（Remove/Scan/Save）有一致的视觉层级

**验收标准**
- 任意 namespace/path 不会破版；溢出有合理显示策略。
- 所有交互控件风格一致，无“裸按钮/裸输入”。

---

### P1 — 配置面板产品化（可编辑性、说明、校验、只读约束）
**问题描述**
- 配置混乱：字段含义不清；有的看似可编辑但无法改动或不生效；可点击但不可改造成困惑。

**任务**
1. 字段分组与说明文案
   - Feature Rules / Scan Roots / Exclude Globs / Debug / Output 等
2. 只读字段彻底不可交互（视觉上禁用、交互上禁止 focus）
3. 表单校验与错误提示（必填/格式/冲突）
4. 保存/应用流程明确
   - 保存成功/失败可见；与扫描触发关系明确（例如“保存后需要重新扫描”提示）

**验收标准**
- 用户能在 1 分钟内理解每个配置项的用途与影响范围。
- 不存在“点得进去但改不了”的控件（除非明确标注只读并禁用）。

---

## 角色与分工建议（可按你的本地 AI 代理拆）
- Agent A（导航/状态）：导航模型、history、breadcrumb、回退逻辑、一致性验收
- Agent B（Mermaid 视口）：pan/zoom/reset/fit、与点击识别兼容
- Agent C（布局/样式）：三栏布局、侧栏滚动/折叠、组件样式系统、溢出策略
- Agent D（配置面板）：字段分组、说明、只读策略、校验与保存反馈
- Agent E（QA/验收脚本）：按验收标准逐条验证，记录回归问题

---

## 交付物
- UI 改动后的截图（至少 3 张：L0 总览、L1 选中节点、配置面板折叠状态）
- 一份 UX 变更说明（简短即可）：列出新增的导航/视口/反馈能力与快捷方式
- 可选：对外发布的“操作手册”小节（放 README 或 RUNBOOK）

